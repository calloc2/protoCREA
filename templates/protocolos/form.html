{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - CREA-TO{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-8">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'protocolos:lista' %}">Protocolos</a></li>
                <li class="breadcrumb-item active">{{ action|title }}</li>
            </ol>
        </nav>
        <h1 class="h3 mb-0">{{ title }}</h1>
        <p class="text-muted">
            {% if action == 'criar' %}
            Preencha os dados para criar um novo protocolo
            {% else %}
            Edite as informações do protocolo
            {% endif %}
        </p>
    </div>
    <div class="col-md-4 text-end">
        <a href="{% url 'protocolos:lista' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Voltar
        </a>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-file-text"></i> Dados do Protocolo
                </h5>
            </div>
            <div class="card-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.numero.id_for_label }}" class="form-label">
                                    {{ form.numero.label }}
                                </label>
                                {{ form.numero }}
                                {% if form.numero.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.numero.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.numero.help_text %}
                                <div class="form-text">{{ form.numero.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.tipo.id_for_label }}" class="form-label">
                                    {{ form.tipo.label }}
                                </label>
                                {{ form.tipo }}
                                {% if form.tipo.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.tipo.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.tipo.help_text %}
                                <div class="form-text">{{ form.tipo.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3" id="cpfCnpjField">
                                <label for="{{ form.cpf_cnpj.id_for_label }}" class="form-label" id="cpfCnpjLabel">
                                    CPF/CNPJ
                                    <span class="text-danger">*</span>
                                </label>
                                {{ form.cpf_cnpj }}
                                {% if form.cpf_cnpj.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.cpf_cnpj.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                <div class="form-text" id="cpfCnpjHelp">Selecione o tipo de processo primeiro</div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="{{ form.unidade_crea.id_for_label }}" class="form-label">
                                    {{ form.unidade_crea.label }}
                                </label>
                                {{ form.unidade_crea }}
                                {% if form.unidade_crea.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.unidade_crea.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.unidade_crea.help_text %}
                                <div class="form-text">{{ form.unidade_crea.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Local de Armazenamento -->
                    <div class="row">
                        <div class="col-md-12">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-geo-alt"></i> Local de Armazenamento
                            </h6>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="{{ form.armario.id_for_label }}" class="form-label">
                                    {{ form.armario.label }}
                                </label>
                                {{ form.armario }}
                                {% if form.armario.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.armario.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.armario.help_text %}
                                <div class="form-text">{{ form.armario.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="{{ form.prateleira.id_for_label }}" class="form-label">
                                    {{ form.prateleira.label }}
                                </label>
                                {{ form.prateleira }}
                                {% if form.prateleira.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.prateleira.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.prateleira.help_text %}
                                <div class="form-text">{{ form.prateleira.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="{{ form.caixa.id_for_label }}" class="form-label">
                                    {{ form.caixa.label }}
                                </label>
                                {{ form.caixa }}
                                {% if form.caixa.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.caixa.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.caixa.help_text %}
                                <div class="form-text">{{ form.caixa.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="{{ form.observacoes.id_for_label }}" class="form-label">
                                    {{ form.observacoes.label }}
                                </label>
                                {{ form.observacoes }}
                                {% if form.observacoes.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.observacoes.errors %}
                                    {{ error }}
                                    {% endfor %}
                                </div>
                                {% endif %}
                                {% if form.observacoes.help_text %}
                                <div class="form-text">{{ form.observacoes.help_text }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Documentos -->
                    <div class="row">
                        <div class="col-md-12">
                            <h6 class="text-muted mb-3">
                                <i class="bi bi-file-earmark-text"></i> Documentos do Processo
                            </h6>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <button type="button" class="btn btn-outline-primary" id="btnAdicionarDocumento">
                                    <i class="bi bi-plus-circle"></i> Adicionar Documentos
                                </button>
                                <div id="documentosLista" class="mt-3">
                                    <!-- Lista de documentos será inserida aqui via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'protocolos:lista' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i>
                            {% if action == 'criar' %}
                            Criar Protocolo
                            {% else %}
                            Salvar Alterações
                            {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Informações Adicionais -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-info-circle"></i> Informações Importantes
                </h6>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li>A data de emissão será automaticamente definida para hoje</li>
                    <li>Selecione o tipo de processo antes de preencher os demais campos</li>
                    <li>CPF/CNPJ é obrigatório apenas para processos finalísticos</li>
                    <li>CPF deve ter 11 dígitos e CNPJ deve ter 14 dígitos</li>
                    <li>O número do protocolo deve ser único no sistema</li>
                    <li>Use o botão "Adicionar Documentos" para incluir documentos no processo</li>
                    <li>O campo Protocolo SITAC será preenchido automaticamente pela API do SITAC</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM carregado, iniciando script...');
    
    const tipoSelect = document.getElementById('id_tipo');
    const cpfCnpjInput = document.getElementById('id_cpf_cnpj');
    const cpfCnpjField = cpfCnpjInput ? cpfCnpjInput.closest('.mb-3') : null;
    const cpfCnpjLabel = document.getElementById('cpfCnpjLabel');
    const cpfCnpjHelp = document.getElementById('cpfCnpjHelp');
    const btnAdicionarDocumento = document.getElementById('btnAdicionarDocumento');
    const documentosLista = document.getElementById('documentosLista');
    
    console.log('Elementos encontrados:');
    console.log('- tipoSelect:', tipoSelect);
    console.log('- cpfCnpjInput:', cpfCnpjInput);
    console.log('- cpfCnpjField:', cpfCnpjField);
    console.log('- btnAdicionarDocumento:', btnAdicionarDocumento);
    console.log('- documentosLista:', documentosLista);
    
    let contadorDocumentos = 0;
    
    // Função para controlar visibilidade e obrigatoriedade do campo CPF/CNPJ
    function controlarCampoCpfCnpj() {
        const tipo = tipoSelect.value;
        
        if (!tipo || tipo === '') {
            // Nenhum tipo selecionado - ocultar campo
            cpfCnpjField.style.display = 'none';
            cpfCnpjInput.value = '';
            cpfCnpjInput.removeAttribute('required');
            cpfCnpjLabel.innerHTML = 'CPF/CNPJ <span class="text-danger">*</span>';
            cpfCnpjHelp.textContent = 'Selecione o tipo de processo primeiro';
        } else if (tipo === 'administrativo') {
            cpfCnpjField.style.display = 'none';
            cpfCnpjInput.value = '';
            cpfCnpjInput.removeAttribute('required');
        } else if (tipo === 'finalistico_pf') {
            cpfCnpjField.style.display = 'block';
            cpfCnpjInput.setAttribute('required', 'required');
            cpfCnpjInput.placeholder = '000.000.000-00';
            cpfCnpjLabel.innerHTML = 'CPF <span class="text-danger">*</span>';
            cpfCnpjHelp.textContent = 'Digite o CPF com 11 dígitos';
        } else if (tipo === 'finalistico_pj') {
            cpfCnpjField.style.display = 'block';
            cpfCnpjInput.setAttribute('required', 'required');
            cpfCnpjInput.placeholder = '00.000.000/0000-00';
            cpfCnpjLabel.innerHTML = 'CNPJ <span class="text-danger">*</span>';
            cpfCnpjHelp.textContent = 'Digite o CNPJ com 14 dígitos';
        } else {
            cpfCnpjField.style.display = 'block';
            cpfCnpjInput.removeAttribute('required');
            cpfCnpjInput.placeholder = 'CPF ou CNPJ';
            cpfCnpjLabel.innerHTML = 'CPF/CNPJ';
            cpfCnpjHelp.textContent = 'Digite CPF (11 dígitos) ou CNPJ (14 dígitos)';
        }
    }
    
    // Event listener para mudança no tipo de processo
    tipoSelect.addEventListener('change', controlarCampoCpfCnpj);
    
    // Inicializar estado do campo CPF/CNPJ
    controlarCampoCpfCnpj();
    
    // Máscara para CPF/CNPJ
    cpfCnpjInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        
        if (value.length <= 11) {
            // Formata como CPF
            value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        } else if (value.length <= 14) {
            // Formata como CNPJ
            value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
        }
        
        e.target.value = value;
    });
    
    // Validação em tempo real
    cpfCnpjInput.addEventListener('blur', function(e) {
        const value = e.target.value.replace(/\D/g, '');
        const tipo = tipoSelect.value;
        const feedback = this.parentNode.querySelector('.invalid-feedback');
        
        let isValid = true;
        let errorMessage = '';
        
        if (tipo === 'finalistico_pf' && value.length !== 11) {
            isValid = false;
            errorMessage = 'CPF deve ter 11 dígitos para processos finalísticos de pessoa física';
        } else if (tipo === 'finalistico_pj' && value.length !== 14) {
            isValid = false;
            errorMessage = 'CNPJ deve ter 14 dígitos para processos finalísticos de pessoa jurídica';
        } else if (tipo === 'administrativo' && value.length > 0) {
            isValid = false;
            errorMessage = 'CPF/CNPJ não deve ser informado para processos administrativos';
        }
        
        if (!isValid) {
            if (!feedback) {
                const div = document.createElement('div');
                div.className = 'invalid-feedback d-block';
                div.textContent = errorMessage;
                this.parentNode.appendChild(div);
            } else {
                feedback.textContent = errorMessage;
            }
        } else if (feedback) {
            feedback.remove();
        }
    });
    
    // Função para adicionar documento
    function adicionarDocumento() {
        console.log('Função adicionarDocumento chamada');
        const tipo = tipoSelect.value;
        console.log('Tipo selecionado:', tipo);
        
        if (!tipo) {
            alert('Selecione primeiro o tipo de processo');
            return;
        }
        
        contadorDocumentos++;
        console.log('Contador de documentos:', contadorDocumentos);
        
        const documentoDiv = document.createElement('div');
        documentoDiv.className = 'card mb-2';
        documentoDiv.innerHTML = `
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <select name="documentos[${contadorDocumentos}][tipo_documento]" class="form-control" required>
                            <option value="">Selecione o tipo de documento</option>
                            <!-- Opções serão carregadas via AJAX -->
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="button" class="btn btn-outline-danger btn-sm" onclick="removerDocumento(this)">
                            <i class="bi bi-trash"></i> Remover
                        </button>
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-md-12">
                        <textarea name="documentos[${contadorDocumentos}][observacoes]" class="form-control" rows="2" placeholder="Observações sobre este documento"></textarea>
                    </div>
                </div>
            </div>
        `;
        
        documentosLista.appendChild(documentoDiv);
        console.log('Documento adicionado à lista');
        
        // Carregar tipos de documento via AJAX
        carregarTiposDocumento(documentoDiv.querySelector('select'), tipo);
    }
    
    // Função para carregar tipos de documento
    function carregarTiposDocumento(selectElement, tipoProcesso) {
        // Limpar opções existentes
        selectElement.innerHTML = '<option value="">Selecione o tipo de documento</option>';
        
        // Fazer requisição AJAX para buscar tipos de documento
        fetch(`/protocolos/tipos-documento/?categoria=${tipoProcesso}`)
            .then(response => response.json())
            .then(data => {
                data.tipos.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo.id;
                    option.textContent = tipo.nome;
                    selectElement.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Erro ao carregar tipos de documento:', error);
                // Fallback para dados estáticos em caso de erro
                carregarTiposDocumentoFallback(selectElement, tipoProcesso);
            });
    }
    
    // Função fallback com dados estáticos
    function carregarTiposDocumentoFallback(selectElement, tipoProcesso) {
        const tiposDocumento = {
            'finalistico_pf': [
                'Anotação de Responsabilidade Técnica',
                'Atribuição Profissional',
                'Cancelamento de Registro',
                'Certidão de Acervo Técnico – CAT',
                'Certidão de Georreferenciamento',
                'Certidão de Registro e Quitação – CRQ',
                'Certidão Diversa',
                'Cobrança, Dívida Ativa e Financeiro',
                'Documento de Fiscalização',
                'Defesa de Fiscalização',
                'Denúncia',
                'Interrupção de Registro',
                'Recadastramento',
                'Reativação de Registro',
                'Registro',
                'Substituição de Registro Provisório para Definitivo',
                'Visto Profissional'
            ],
            'finalistico_pj': [
                'Atualização de Dados Cadastrais',
                'Baixa de Responsável Técnico',
                'Cadastro de Filial',
                'Cancelamento de Registro de Empresa',
                'Documento de Fiscalização',
                'Inclusão de Responsável Técnico',
                'Interrupção de Registro de Empresa',
                'Recadastramento',
                'Reativação de Registro',
                'Registro de instituição de Ensino',
                'Registro',
                'Visto de Empresa'
            ],
            'administrativo': [
                'Administrativos / Financeiro',
                'Aluguel',
                'Área de Patrimônio, Almoxarifado e Serviços Gerais',
                'Assessoria das Câmaras',
                'Assessoria de Comunicação',
                'Baixa de Pagamento de ART',
                'Cobrança / Dívida Ativa',
                'Colegiado',
                'Compra de Equipamento de Informática',
                'Compra de Material de Expediente / Limpeza',
                'Compra de Mobiliário',
                'Compra de Veículo',
                'Convênio',
                'Demonstrativo Financeiro',
                'Diárias, Passagens, Deslocamentos, Ajuda de Custo',
                'Eleição',
                'Gerência de ART e Gerência Técnica',
                'Gerência de Fiscalização',
                'Gerência de Tecnologia da Informação',
                'Honorários',
                'Infraestrutura',
                'Licitação',
                'Memorando',
                'Ofício',
                'Outros',
                'Ouvidoria',
                'Passagem Aérea',
                'Plenário',
                'Presidência',
                'Protocolo',
                'Renovação de Contrato',
                'Ressarcimento',
                'Seguro',
                'Superintendência',
                'Suprimento de Fundos',
                'Transporte'
            ]
        };
        
        const tipos = tiposDocumento[tipoProcesso] || [];
        tipos.forEach(tipo => {
            const option = document.createElement('option');
            option.value = tipo;
            option.textContent = tipo;
            selectElement.appendChild(option);
        });
    }
    
    // Função para remover documento
    window.removerDocumento = function(button) {
        button.closest('.card').remove();
    };
    
    // Event listener para o botão adicionar documento
    if (btnAdicionarDocumento) {
        console.log('Adicionando event listener ao botão...');
        btnAdicionarDocumento.addEventListener('click', function(e) {
            console.log('Botão clicado!');
            e.preventDefault();
            adicionarDocumento();
        });
    } else {
        console.error('Botão btnAdicionarDocumento não encontrado!');
    }
    
    // Função para gerar resumo do protocolo
    function gerarResumoProtocolo() {
        const form = document.querySelector('form');
        const formData = new FormData(form);
        
        const resumo = {
            numero: formData.get('numero') || '',
            tipo: formData.get('tipo') || '',
            cpf_cnpj: formData.get('cpf_cnpj') || '',
            unidade_crea: formData.get('unidade_crea') || '',
            armario: formData.get('armario') || '',
            prateleira: formData.get('prateleira') || '',
            caixa: formData.get('caixa') || '',
            observacoes: formData.get('observacoes') || '',
            documentos: []
        };
        
        // Coletar documentos adicionados
        const documentosSelects = document.querySelectorAll('select[name*="documentos"][name*="tipo_documento"]');
        const documentosTextareas = document.querySelectorAll('textarea[name*="documentos"][name*="observacoes"]');
        
        for (let i = 0; i < documentosSelects.length; i++) {
            const select = documentosSelects[i];
            const textarea = documentosTextareas[i];
            if (select.value) {
                resumo.documentos.push({
                    tipo: select.options[select.selectedIndex].text,
                    observacoes: textarea ? textarea.value : ''
                });
            }
        }
        
        return resumo;
    }
    
    // Função para mostrar confirmação
    function mostrarConfirmacao(resumo) {
        let html = `
            <div class="modal fade" id="confirmacaoModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="bi bi-check-circle text-success"></i> Confirmar Criação do Protocolo
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle"></i> 
                                Por favor, confirme os dados do protocolo antes de criar:
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-muted">Informações Básicas</h6>
                                    <table class="table table-sm">
                                        <tr><td><strong>Número:</strong></td><td>${resumo.numero}</td></tr>
                                        <tr><td><strong>Tipo:</strong></td><td>${resumo.tipo}</td></tr>
                                        ${resumo.cpf_cnpj ? `<tr><td><strong>CPF/CNPJ:</strong></td><td>${resumo.cpf_cnpj}</td></tr>` : ''}
                                        <tr><td><strong>Unidade CREA:</strong></td><td>${resumo.unidade_crea}</td></tr>
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-muted">Localização</h6>
                                    <table class="table table-sm">
                                        <tr><td><strong>Armário:</strong></td><td>${resumo.armario}</td></tr>
                                        <tr><td><strong>Prateleira:</strong></td><td>${resumo.prateleira}</td></tr>
                                        <tr><td><strong>Caixa:</strong></td><td>${resumo.caixa}</td></tr>
                                    </table>
                                </div>
                            </div>
        `;
        
        if (resumo.observacoes) {
            html += `
                <div class="mt-3">
                    <h6 class="text-muted">Observações</h6>
                    <div class="alert alert-light">${resumo.observacoes}</div>
                </div>
            `;
        }
        
        if (resumo.documentos.length > 0) {
            html += `
                <div class="mt-3">
                    <h6 class="text-muted">Documentos (${resumo.documentos.length})</h6>
                    <div class="list-group">
            `;
            resumo.documentos.forEach((doc, index) => {
                html += `
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${index + 1}. ${doc.tipo}</h6>
                        </div>
                        ${doc.observacoes ? `<p class="mb-1 text-muted">${doc.observacoes}</p>` : ''}
                    </div>
                `;
            });
            html += `
                    </div>
                </div>
            `;
        }
        
        html += `
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </button>
                            <button type="button" class="btn btn-success" id="confirmarCriacao">
                                <i class="bi bi-check-circle"></i> Confirmar e Criar Protocolo
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Remover modal anterior se existir
        const modalAnterior = document.getElementById('confirmacaoModal');
        if (modalAnterior) {
            modalAnterior.remove();
        }
        
        // Adicionar modal ao body
        document.body.insertAdjacentHTML('beforeend', html);
        
        // Mostrar modal
        const modal = new bootstrap.Modal(document.getElementById('confirmacaoModal'));
        modal.show();
        
        // Event listener para confirmar
        document.getElementById('confirmarCriacao').addEventListener('click', function() {
            modal.hide();
            // Enviar formulário
            document.querySelector('form').submit();
        });
    }
    
    // Interceptar submit do formulário
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validar se tipo foi selecionado
            if (!tipoSelect.value) {
                alert('Por favor, selecione o tipo de processo antes de continuar.');
                tipoSelect.focus();
                return;
            }
            
            // Gerar resumo e mostrar confirmação
            const resumo = gerarResumoProtocolo();
            mostrarConfirmacao(resumo);
        });
    }
});
</script>
{% endblock %}
