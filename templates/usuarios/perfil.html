{% extends "base.html" %}
{% block title %}Meu Perfil - CREA-TO{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-4">
    <div class="card shadow mb-4">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Informações Pessoais</h5>
      </div>
      <div class="card-body">
        <div class="text-center mb-3">
          <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
            <span class="h3 text-muted">{{ user.first_name|first|upper }}{{ user.last_name|first|upper }}</span>
          </div>
        </div>
        
        <h6 class="card-title">{{ user.get_full_name }}</h6>
        <p class="text-muted mb-2">{{ user.email }}</p>
        {% if perfil %}
          <p class="text-muted mb-2">CPF: {{ perfil.cpf }}</p>
          {% if perfil.telefone %}
            <p class="text-muted mb-2">Telefone: {{ perfil.telefone }}</p>
          {% endif %}
          
          <div class="mt-3">
            <span class="badge bg-secondary">{{ perfil.get_permissao_display|default:"N/A" }}</span>
          </div>
        {% endif %}
        
        <div class="mt-3">
          <a href="{% url 'usuarios:editar_perfil' %}" class="btn btn-outline-primary btn-sm">Editar Perfil</a>
        </div>
      </div>
    </div>
    
    <div class="card shadow">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0">Status da Conta</h6>
      </div>
      <div class="card-body">
        {% if perfil %}
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Conta Aprovada:</span>
            {% if perfil.conta_aprovada %}
              <span class="badge bg-success">✓ Sim</span>
            {% else %}
              <span class="badge bg-warning">✗ Não</span>
            {% endif %}
          </div>
          
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Pode Publicar:</span>
            {% if perfil.pode_publicar %}
              <span class="badge bg-success">✓ Sim</span>
            {% else %}
              <span class="badge bg-secondary">✗ Não</span>
            {% endif %}
          </div>
          
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span>Nível de Permissão:</span>
            <span class="badge bg-info">{{ perfil.get_permissao_display|default:"N/A" }}</span>
          </div>
          
          {% if perfil.data_aprovacao %}
            <hr>
            <small class="text-muted">
              Aprovado em: {{ perfil.data_aprovacao|date:"d/m/Y H:i" }}
            </small>
          {% endif %}
        {% else %}
          <p class="text-muted text-center">Perfil não encontrado.</p>
        {% endif %}
      </div>
    </div>
  </div>
  
  <div class="col-md-8">
    <div class="card shadow mb-4">
      <div class="card-header bg-info text-white">
        <h5 class="mb-0">Informações Profissionais</h5>
      </div>
      <div class="card-body">
        {% if perfil %}
          <div class="row">
            <div class="col-md-6">
              {% if perfil.registro_profissional %}
                <p><strong>Registro Profissional:</strong> {{ perfil.registro_profissional }}</p>
              {% endif %}
            </div>
            <div class="col-md-6">
              {% if perfil.empresa %}
                <p><strong>Empresa/Instituição:</strong> {{ perfil.empresa }}</p>
              {% endif %}
              {% if perfil.cargo %}
                <p><strong>Cargo/Função:</strong> {{ perfil.cargo }}</p>
              {% endif %}
            </div>
          </div>
          
          {% if not perfil.registro_profissional and not perfil.empresa and not perfil.cargo %}
            <div class="alert alert-info">
              <small>Complete suas informações profissionais para um perfil mais completo.</small>
            </div>
          {% endif %}
        {% else %}
          <p class="text-muted text-center">Perfil não encontrado.</p>
        {% endif %}
      </div>
    </div>
    
    {% if perfil and perfil.can_publish %}
    <div class="card shadow mb-4">
      <div class="card-header bg-success text-white">
        <h6 class="mb-0">Permissões de Publicação</h6>
      </div>
      <div class="card-body">
        <p class="text-success mb-2">
          <strong>✓ Você pode publicar atas no sistema!</strong>
        </p>
        <p class="text-muted small">
          Com esta permissão, você pode criar e gerenciar protocolos.
        </p>
        <div class="mt-3">
          <a href="{% url 'protocolos:criar' %}" class="btn btn-success btn-sm">Criar Novo Protocolo</a>
        </div>
      </div>
    </div>
    {% endif %}
    
    {% if not perfil or not perfil.is_approved %}
    <div class="card shadow">
      <div class="card-header bg-warning text-dark">
        <h6 class="mb-0">Status da Conta</h6>
      </div>
      <div class="card-body">
        <div class="alert alert-warning mb-0">
          <strong>Atenção:</strong> 
          {% if not perfil %}
            Seu perfil ainda não foi criado.
          {% else %}
            Sua conta ainda não foi aprovada.
          {% endif %}
          <br>
          Entre em contato com o administrador para mais informações.
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
